# Article Import

This is an overview of the mapping and importing of `Article` entities
from the EBMS 3.x system.

## Structure
At a very granular level, the structure of `Article` entities contains:

* `id` (integer, from ebms_article.article_id)
* `title` (string, extracted from PubMed XML)
* `search_title` (string, calculated at save time)
* `authors` (zero or more Author fields, from PubMed XML)
   - `last_name` (string)
   - `first_name` (string)
   - `initials` (string)
   - `collective_name` (string)
   - `display_name` (string, calculated at save time)
   - `search_name` (string, calculated at save time)
* `source` (string, always 'Pubmed')
* `source_id` (string, from PubMed XML)
* `source_journal_id` (string, from PubMed XML)
* `source_status` (string, from PubMed XML)
* `journal_title` (string, from PubMed XML)
* `brief_journal_title` (string, from PubMed XML)
* `volume` (string, from PubMed XML)
* `issue` (string, from PubMed XML)
* `pagination` (string, from PubMed XML)
* `abstract` (zero or more AbstractParagraph fields, from PubMed XML)
    - `paragraph_text` (string)
    - `paragraph_label` (string)
* `pub_date` (PubDate field, from PubMed XML)
    - `year` (string)
    - `month` (string)
    - `day` (string)
    - `season` (string)
    - `medline_date` (string)
* `year` (integer, from PubMed XML)
* `imported_by` (User reference, from ebms_article.imported_by)
* `import_date` (datetime, from ebms_article.import_date)
* `update_date` (datetime, from ebms_article.update_date)
* `data_mod` (date, from ebms_article.data_mod)
* `data_checked` (date, from ebms_article.data_checked)
* `full_text` (FullText field, from DB)
    - `file` (File reference, from ebms_article.full_text_id)
    - `unavailable` (boolean, ebms_ft_unavailable row present for article ID)
    - `flagged_as_unavailable` (datetime, from ebms_ft_unavailable.flagged)
    - `flagged_by` (User reference, from ebms_ft_unavailable)
    - `notes` (string, from ebms_ft_unavailable.comment)
* `topics` (zero or more ArticleTopic entity references)
    - `id` (integer, created by the migration)
    - `topic` (Topic reference, ebms_article_topic.topic_id)
    - `cycle` (datetime, mapped using ebms_article_topic.cycle_id)
    - `states` (zero or more State entity references, matching article+topic)
      - `id` (integer, ebms_article_state.article_state_id)
      - `value` (reference to Term entity, from ebms_article_state.state_id)
      - `board` (reference to Board entity, from ebms_article_state.board_id)
      - `topic` (reference to Topic entity, from ebms_article_state.topic_id)
      - `user` (reference to User entity, from ebms_article_state.user_id)
      - `entered` (datetime, from ebms_article_state.status_dt)
      - `active` (boolean, from ebms_article_state.active_status == 'A')
      - `current` (boolean, ebms_article_state.current == 'Y')
      - `comments` (zero or more SimpleComment fields)
        - `user` (reference to User entity, ebms_article_state_comment.user_id)
        - `entered` (datetime, ebms_article_state_comment, comment_dt)
        - `body` (string, ebms_article_state_comment.comment)
      - `decisions` (zero or more BoardDecision fields)
        - `decision` (reference to Term entity,
                  ebms_article_board_decision.decision_value_id)
        - `meeting_date` (datetime, ebms_article_board_decision.meeting_date
                      reference to the ebms_cycle table)
        - `discussed` (boolean, ebms_article_board_decision.discussed == 'Y')
      - `deciders` (zero or more references to User entities, from
                ebms_article_board_decision_member.uid)
      - `meetings` (zero or more references to Meeting entities,
                from ebms_agenda_meeting.nid)
    - `tags` (zero or more ArticleTag entity references, using rows from
          ebms_article_tag with matching article_id and topic_id)
      - `id` (integer, ebms_article_tag.article_tag_id)
      - `tag` (reference to Term entity, from ebms_article_tag.tag_id)
      - `user` (reference to User entity, ebms_article_tag.user_id)
      - `assigned` (datetime, ebms_article_tag.tag_dt)
      - `comments` (zero or more instances of SimpleComment fields,
                using ebms_article_tag_comment rows)
      - `active` (boolean, ebms_article_tag.active_status == 'A')
    - `comments` (zero or more ModifiableComment fields)
      - `user` (User entity reference, ebms_article_topic_comment.created_by)
      - `entered` (datetime, ebms_article_topic_comment.created)
      - `comment` (string, ebms_article_topic_comment.comment)
      - `modified` (datetime, ebms_article_topic_comment.modified)
      - `modified_by` (User entity reference, from
                   ebms_article_topic_comment.modified_by)
* `tags` (zero or more references to ArticleTag entities, see structure above;
        rows which match the article_id, but have no topic_id)
* `internal_tags` (zero or more InternalTag fields)
    - `tag` (reference to Term entity, ebms_internal_article_tag.tag_id)
    - `added` (datetime, ebms_internal_article_tag.tag_added)
* `internal_comments` (zero or more instances of SimpleComment fields,
                     using ebms_internal_article_comment)
* `types` (zero or more strings, extracted from PubMed XML)
* `legacy_id` (integer, from ebms_legacy_article_id.legacy_id)
* `last_author_name` (string, calculated by save())
* `publication` (string, computed at runtime)
